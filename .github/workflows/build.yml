name: DnD LaTeX compilation
on: [push]
jobs:
  build_latex:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git repository
        uses: actions/checkout@v2

      - name: Install TeX Live XeTeX package
        run: sudo apt-get install -y texlive-xetex

      - name: Clone DND-5e-LaTeX-Template and copy dnd.sty
        run: |
          git clone https://github.com/rpgtex/DND-5e-LaTeX-Template.git
          mkdir -p latex_packages
          cp DND-5e-LaTeX-Template/dnd.sty latex_packages/

      - name: Compile all .tex files in the working directory
        run: |
          mkdir -p output
          for texfile in ./characters/*.tex; do
            outputfile="output/$(basename -s .tex $texfile).pdf"
            echo "Compiling $texfile -> $outputfile"
            xelatex -interaction=nonstopmode -output-directory=output "$texfile"
          done

      - name: Compile the main document
        uses: dante-ev/latex-action@master
        with:
          root_file: "" # Leave this empty
          working_directory: ./characters
          compiler: xelatex
